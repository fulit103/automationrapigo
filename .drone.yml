kind: pipeline
type: docker
name: default

steps:
- name: test
  image: juliantoro/fastapibase
  commands:
  - pip install -r src/requirements.txt  
  - pytest src/tests/test_initial.py

- name: "packer"
  image: appleboy/drone-packer
  settings:
    template: template.json
    actions: build

services:
- name: dbmysql
  image: mysql
  environment:
    MYSQL_ROOT_PASSWORD: example
    MYSQL_ROOT_PASSWORD: secret
    MYSQL_DATABASE: automation
    MYSQL_USER: admin
    MYSQL_PASSWORD": example

# - name: testdocker
#   image: docker:dind
#   volumes:
#   - name: dockersock
#     path: /var/run
#   commands:
#   - sleep 10 # give docker enough time to start
#   - docker ps -a

# volumes:
# - name: dockersock
#   temp: {}